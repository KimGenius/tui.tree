/*!Component-Tree v0.0.1 | NHN Entertainment*/!function(){!function(a){var b={NORMAL:0,EDITABLE:1},c={OPEN:["open","-"],CLOSE:["close","+"],SELECT_CLASS:"selected",SUBTREE_CLASS:"Subtree",VALUE_CLASS:"valueClass",EDITABLE_CLASS:"editableClass",TEMPLATE:{EDGE_NODE:'<li class="edge_node {{State}}"><button type="button">{{StateLabel}}</button><span id="{{NodeID}}" class="depth{{Depth}} {{ValueClass}}">{{Title}}</span><em>{{DepthLabel}}</em><ul class="{{Subtree}}" style="display:{{Display}}">{{Children}}</ul></li>',LEAP_NODE:'<li class="leap_node"><span id="{{NodeID}}" class="depth{{Depth}} {{ValueClass}}">{{Title}}</span><em>{{DepthLabel}}</em></li>'},USE_DRAG:!1,USE_HELPER:!1,HELPER_POS:{x:10,y:10}},d={addEventListener:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeEventListener:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},getTarget:function(a){a=a||window.event;var b=a.target||a.srcElement;return b},hasClass:function(a,b){if(!a||!b)throw new Error("#util.hasClass(element, className) 엘리먼트가 입력되지 않았습니다. \n__element"+a+",__className"+b);var c=a.className;return-1!==c.indexOf(b)?!0:!1},getElementsByClass:function(b,c){if(b.querySelectorAll)return b.querySelectorAll("."+c);var d=b.getElementsByTagName("*"),e=[];return d=a.util.toArray(d),a.util.forEach(d,function(a){var b=a.className||"";-1!==b.indexOf(c)&&e.push(a)}),e},isRightButton:function(a){var b=2===d._getButton(a);return b},testProp:function(a){for(var b=document.documentElement.style,c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},_getButton:function(a){var b,c="0,1,3,5,7",d="2,6",e="4";return document.implementation.hasFeature("MouseEvents","2.0")?a.button:(b=a.button+"",c.indexOf(b)>-1?0:d.indexOf(b)>-1?2:e.indexOf(b)>-1?1:void 0)}};window.ne=a=a||{},a.component=a.component||{},a.component.Tree=a.util.defineClass({init:function(d,e,f){this.template=f.template||c.TEMPLATE,this.root=null,this.openSet=f.openSet||c.OPEN,this.closeSet=f.closeSet||c.CLOSE,this.onselectClass=f.selectClass||c.SELECT_CLASS,this.valueClass=f.valueClass||c.VALUE_CLASS,this.editClass=f.inputClass||c.EDITABLE_CLASS,this.depthLabels=f.depthLabels||[],this.state=b.NORMAL,this.subtreeClass=f.subtreeClass||c.SUBTREE_CLASS,this.useDrag=f.useDrag||c.USE_DRAG,this.useHelper=this.useDrag&&(f.useHelper||c.USE_HELPER),this.helperPos=f.helperPos||c.HELPER_POS,this.inputElement=this.getEditableElement(),this.model=new a.component.Tree.TreeModel(f.modelOption,this),this.model.setData(e),d?this.root=document.getElementById(d):(this.root=document.createElement("ul"),document.body.appendChild(this.root)),this._draw(this._getHtml(this.model.treeHash.root.childKeys)),this.setEvents()},getEditableElement:function(){var a=document.createElement("input");return a.className=this.editClass,a.setAttribute("type","text"),a},setEvents:function(){d.addEventListener(this.root,"click",a.util.bind(this._onClick,this)),d.addEventListener(this.inputElement,"blur",a.util.bind(this._onBlurInput,this)),d.addEventListener(this.inputElement,"keyup",a.util.bind(this._onKeyup,this)),this.useDrag&&this._addDragEvent()},_addDragEvent:function(){var b=d.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]),c="onselectstart"in document;if(c)d.addEventListener(this.root,"selectstart",d.preventDefault);else{var e=document.documentElement.style;e[b]="none"}d.addEventListener(this.root,"mousedown",a.util.bind(this._onMouseDown,this))},_onKeyup:function(a){if(13===a.keyCode){var b=d.getTarget(a);this.model.rename(this.current.id,b.value),this.changeState(this.current)}},_onBlurInput:function(a){if(this.state!==b.NORMAL){var c=d.getTarget(a);this.model.rename(this.current.id,c.value),this.changeState(this.current)}},_onClick:function(b){var c=d.getTarget(b);return d.isRightButton(b)?void(this.clickTimer=null):d.hasClass(c,this.valueClass)?void(this.clickTimer?(this._onDoubleClick(b),window.clearTimeout(this.clickTimer),this.clickTimer=null):this.clickTimer=setTimeout(a.util.bind(function(){this._onSingleClick(b)},this),400)):void this._onSingleClick(b)},_onSingleClick:function(a){this.clickTimer=null;var b=d.getTarget(a),c=b.tagName.toUpperCase(),e=b.parentNode,f=d.getElementsByClass(e,this.valueClass)[0];"INPUT"!==c&&("BUTTON"===c?this.model.changeState(f.id):this.model.setBuffer(f.id))},changeState:function(a){this.state===b.EDITABLE?(this.state=b.NORMAL,this.action("restore",a)):(this.state=b.EDITABLE,this.action("convert",a))},_onDoubleClick:function(a){var b=d.getTarget(a);this.changeState(b)},_onMouseDown:function(c){if(this.state!==b.EDITABLE&&!d.isRightButton(c)){d.preventDefault(c);var e=d.getTarget(c),f=e.tagName.toUpperCase();"BUTTON"!==f&&"INPUT"!==f&&d.hasClass(e,this.valueClass)&&(this.pos=this.root.getBoundingClientRect(),this.useHelper&&this.enableHelper({x:c.clientX-this.pos.left,y:c.clientY-this.pos.top},e.innerText||e.textContent),this.move=a.util.bind(this._onMouseMove,this),this.up=a.util.bind(this._onMouseUp,this,e),d.addEventListener(document,"mousemove",this.move),d.addEventListener(document,"mouseup",this.up))}},_onMouseMove:function(a){this.useHelper&&this.setHelperLocation({x:a.clientX-this.pos.left,y:a.clientY-this.pos.top})},_onMouseUp:function(a,b){this.disableHelper();var c=d.getTarget(b),e=this.model,f=e.find(a.id),g=e.find(c.id),h=e.isDisable(g,f);e.find(c.id)&&c.id!==a.id&&!h&&e.move(a.id,f,c.id),d.removeEventListener(document,"mousemove",this.move),d.removeEventListener(document,"mouseup",this.up)},enableHelper:function(a,b){this.helperElement||(this.helperElement=document.createElement("span"),this.helperElement.style.position="absolute",this.helperElement.style.display="none",this.root.parentNode.appendChild(this.helperElement)),this.helperElement.innerHTML=b},setHelperLocation:function(a){this.helperElement.style.left=a.x+this.helperPos.x+"px",this.helperElement.style.top=a.y+this.helperPos.y+"px",this.helperElement.style.display="block"},disableHelper:function(){this.helperElement&&(this.helperElement.style.display="none")},_getHtml:function(b){var c,d,e,f,g,h,i,j,k=this.model,l=[];return a.util.forEach(b,function(b){d=k.find(b),f=d.depth,g=this[d.state+"Set"][0],h=this[d.state+"Set"][1],i=this.depthLabels[f-1]||"",j={State:g,StateLabel:h,NodeID:d.id,Depth:f,Title:d.value,ValueClass:this.valueClass,SubTree:this.subtreeClass,Display:"open"===d.state?"":"none",DepthLabel:i},a.util.isNotEmpty(d.childKeys)?(e=this.template.EDGE_NODE,j.Children=this._getHtml(d.childKeys)):e=this.template.LEAP_NODE,b=e.replace(/\{\{([^\}]+)\}\}/g,function(a,b){return j[b]||""}),l.push(b)},this),c=l.join("")},notify:function(a,b){this.action(a,b)},action:function(a,b){this._actionMap=this._actionMap||{refresh:this._refresh,rename:this._rename,toggle:this._toggleNode,select:this._select,unselect:this._unSelect,convert:this._convert,restore:this._restore},this._actionMap[a||"refresh"].call(this,b)},_changeNodeState:function(b){var c=document.getElementById(b.id);if(c){var d=c.parentNode,e=d.className;e=a.util.isEmpty(b.childKeys)?"leap_node "+this[b.state+"Set"][0]:"edge_node "+this[b.state+"Set"][0],d.className=e}},_convert:function(a){var b=a.id,c=this.model.find(b),d=c.value,e=a.parentNode;this.current&&(this.current.style.display=""),a.style.display="none",this.inputElement.value=d,this.current=a,e.insertBefore(this.inputElement,a),this.inputElement.focus()},_restore:function(a){var b=a.parentNode;this.current&&(this.current.style.display=""),this.inputElement.value="",b.removeChild(this.inputElement)},_draw:function(a,b){var c=b||this.root;c.innerHTML=a},setDepthLabels:function(a){this.depthLabels=a},_refresh:function(){var a=this.model.treeHash.root.childKeys;this._draw(this._getHtml(a))},_rename:function(a){var b=document.getElementById(a.id);b.innerHTML=a.value},_toggleNode:function(a){var b=document.getElementById(a.id),c=b.parentNode,d=c.getElementsByTagName("ul")[0],e=c.getElementsByTagName("button")[0],f=this[a.state+"Set"][0],g=this[a.state+"Set"][1],h="open"===a.state;c.className=c.className.replace(this.openSet[0],"").replace(this.closeSet[0],"")+f,d.style.display=h?"":"none",e.innerHTML=g},_select:function(b){var c=document.getElementById(b.id);a.util.isExisty(c)&&(c.className=c.className.replace(" "+this.onselectClass,"")+" "+this.onselectClass)},_unSelect:function(b){var c=document.getElementById(b.id);a.util.isExisty(c)&&d.hasClass(c,this.onselectClass)&&(c.className=c.className.replace(" "+this.onselectClass,""))}})}(ne),ne.component.Tree.TreeModel=ne.util.defineClass({init:function(a,b){this.count=0,this.tree=b,this.nodeDefaultState=a.defaultState||"close",this.buffer=null,this.depth=0,this.date=(new Date).getTime(),this.treeHash={},this.treeHash.root=this.makeNode(0,"root","root"),this.connect(b)},setData:function(a){this.treeHash.root.childKeys=this._makeTreeHash(a)},_makeTreeHash:function(a,b){var c,d=[];return this.depth=this.depth+1,ne.util.forEach(a,function(a){c=this._getId(),this.treeHash[c]=this.makeNode(this.depth,c,a.value,b),a.children&&ne.util.isNotEmpty(a.children)&&(this.treeHash[c].childKeys=this._makeTreeHash(a.children,c)),d.push(c)},this),this.depth=this.depth-1,d.sort(ne.util.bind(this.sort,this)),d},makeNode:function(a,b,c,d){return{depth:a,value:c,parentId:0===a?null:d||"root",state:this.nodeDefaultState,id:b}},_getId:function(){return this.count=this.count+1,"node_"+this.date+"_"+this.count},find:function(a){return this.treeHash[a]},remove:function(a){var b=this.invoke("remove",{id:a});b&&(this.removeKey(a),this.treeHash[a]=null,this.notify())},removeKey:function(a){var b=this.find(a);if(b){var c=this.find(b.parentId);c.childKeys=ne.util.filter(c.childKeys,function(b){return b!==a})}},move:function(a,b,c){this.removeKey(a),this.treeHash[a]=null,this.insert(b,c)},insert:function(a,b){var c=this.find(b||"root");c.childKeys||(c.childKeys=[]),c.childKeys.push(a.id),a.depth=c.depth+1,a.parentId=b,c.childKeys.sort(ne.util.bind(this.sort,this)),this.treeHash[a.id]=a,this.notify()},notify:function(a,b){this.tree&&this.tree.notify(a,b)},connect:function(a){a&&(this.tree=a)},rename:function(a,b){var c=this.invoke("rename",{id:a,value:b});if(c){var d=this.find(a);d.value=b,this.notify("rename",d)}},changeState:function(a){var b=this.find(a);b.state="open"===b.state?"close":"open",this.notify("toggle",b)},setBuffer:function(a){this.clearBuffer();var b=this.find(a);this.notify("select",b),this.fire("select",{id:a,value:b.value}),this.buffer=b},clearBuffer:function(){this.buffer&&(this.notify("unselect",this.buffer),this.buffer=null)},isDisable:function(a,b){return a.depth===b.depth?!1:a.parentId?a.id===b.parentId?!0:a.parentId===b.id?!0:this.isDisable(this.find(a.parentId),b):void 0},sort:function(a,b){var c=this.find(a),d=this.find(b);return c&&d?c.value<d.value?-1:c.value>d.value?1:0:0}}),ne.util.CustomEvents.mixin(ne.component.Tree.TreeModel)}();