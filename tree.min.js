/*!component-tree v1.0.0 | NHN Entertainment*/
!function(){ne.util.defineNamespace("ne.component");var a={NORMAL:0,EDITABLE:1},b={OPEN:["open","-"],CLOSE:["close","+"],SELECT_CLASS:"selected",SUBTREE_CLASS:"Subtree",VALUE_CLASS:"valueClass",EDITABLE_CLASS:"editableClass",TEMPLATE:{EDGE_NODE:'<li class="edge_node {{State}}"><button type="button">{{StateLabel}}</button><span id="{{NodeID}}" class="depth{{Depth}} {{ValueClass}}">{{Title}}</span><em>{{DepthLabel}}</em><ul class="{{Subtree}}" style="display:{{Display}}">{{Children}}</ul></li>',LEAP_NODE:'<li class="leap_node"><span id="{{NodeID}}" class="depth{{Depth}} {{ValueClass}}">{{Title}}</span><em>{{DepthLabel}}</em></li>'},USE_DRAG:!1,USE_HELPER:!1,HELPER_POS:{x:10,y:10}},c={addEventListener:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeEventListener:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},getTarget:function(a){a=a||window.event;var b=a.target||a.srcElement;return b},hasClass:function(a,b){if(!a||!b)throw new Error("#util.hasClass(element, className) 엘리먼트가 입력되지 않았습니다. \n__element"+a+",__className"+b);var c=a.className;return-1!==c.indexOf(b)?!0:!1},getElementsByClass:function(a,b){if(a.querySelectorAll)return a.querySelectorAll("."+b);var c=a.getElementsByTagName("*"),d=[];return c=ne.util.toArray(c),ne.util.forEach(c,function(a){var c=a.className||"";-1!==c.indexOf(b)&&d.push(a)}),d},isRightButton:function(a){var b=2===c._getButton(a);return b},testProp:function(a){for(var b=document.documentElement.style,c=0;c<a.length;c++)if(a[c]in b)return a[c];return!1},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},_getButton:function(a){var b,c="0,1,3,5,7",d="2,6",e="4";return document.implementation.hasFeature("MouseEvents","2.0")?a.button:(b=a.button+"",c.indexOf(b)>-1?0:d.indexOf(b)>-1?2:e.indexOf(b)>-1?1:void 0)}};ne.component.Tree=ne.util.defineClass({init:function(c,d,e){this.template=e.template||b.TEMPLATE,this.root=null,this.openSet=e.openSet||b.OPEN,this.closeSet=e.closeSet||b.CLOSE,this.onselectClass=e.selectClass||b.SELECT_CLASS,this.valueClass=e.valueClass||b.VALUE_CLASS,this.editClass=e.inputClass||b.EDITABLE_CLASS,this.depthLabels=e.depthLabels||[],this.state=a.NORMAL,this.subtreeClass=e.subtreeClass||b.SUBTREE_CLASS,this.useDrag=e.useDrag||b.USE_DRAG,this.useHelper=this.useDrag&&(e.useHelper||b.USE_HELPER),this.helperPos=e.helperPos||b.HELPER_POS,this.inputElement=this.getEditableElement(),this.model=new ne.component.Tree.TreeModel(e.modelOption,this),this.model.setData(d),c?this.root=document.getElementById(c):(this.root=document.createElement("ul"),document.body.appendChild(this.root)),this._draw(this._getHtml(this.model.treeHash.root.childKeys)),this.setEvents()},getEditableElement:function(){var a=document.createElement("input");return a.className=this.editClass,a.setAttribute("type","text"),a},setEvents:function(){c.addEventListener(this.root,"click",ne.util.bind(this._onClick,this)),c.addEventListener(this.inputElement,"blur",ne.util.bind(this._onBlurInput,this)),c.addEventListener(this.inputElement,"keyup",ne.util.bind(this._onKeyup,this)),this.useDrag&&this._addDragEvent()},_addDragEvent:function(){var a=c.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]),b="onselectstart"in document;if(b)c.addEventListener(this.root,"selectstart",c.preventDefault);else{var d=document.documentElement.style;d[a]="none"}c.addEventListener(this.root,"mousedown",ne.util.bind(this._onMouseDown,this))},_onKeyup:function(a){if(13===a.keyCode){var b=c.getTarget(a);this.model.rename(this.current.id,b.value),this.changeState(this.current)}},_onBlurInput:function(b){if(this.state!==a.NORMAL){var d=c.getTarget(b);this.model.rename(this.current.id,d.value),this.changeState(this.current)}},_onClick:function(a){var b=c.getTarget(a);return c.isRightButton(a)?void(this.clickTimer=null):c.hasClass(b,this.valueClass)?void(this.clickTimer?(this._onDoubleClick(a),window.clearTimeout(this.clickTimer),this.clickTimer=null):this.clickTimer=setTimeout(ne.util.bind(function(){this._onSingleClick(a)},this),400)):void this._onSingleClick(a)},_onSingleClick:function(a){this.clickTimer=null;var b=c.getTarget(a),d=b.tagName.toUpperCase(),e=b.parentNode,f=c.getElementsByClass(e,this.valueClass)[0];"INPUT"!==d&&("BUTTON"===d?this.model.changeState(f.id):this.model.setBuffer(f.id))},changeState:function(b){this.state===a.EDITABLE?(this.state=a.NORMAL,this.action("restore",b)):(this.state=a.EDITABLE,this.action("convert",b))},_onDoubleClick:function(a){var b=c.getTarget(a);this.changeState(b)},_onMouseDown:function(b){if(this.state!==a.EDITABLE&&!c.isRightButton(b)){c.preventDefault(b);var d=c.getTarget(b),e=d.tagName.toUpperCase();"BUTTON"!==e&&"INPUT"!==e&&c.hasClass(d,this.valueClass)&&(this.pos=this.root.getBoundingClientRect(),this.useHelper&&this.enableHelper({x:b.clientX-this.pos.left,y:b.clientY-this.pos.top},d.innerText||d.textContent),this.move=ne.util.bind(this._onMouseMove,this),this.up=ne.util.bind(this._onMouseUp,this,d),c.addEventListener(document,"mousemove",this.move),c.addEventListener(document,"mouseup",this.up))}},_onMouseMove:function(a){this.useHelper&&this.setHelperLocation({x:a.clientX-this.pos.left,y:a.clientY-this.pos.top})},_onMouseUp:function(a,b){this.disableHelper();var d=c.getTarget(b),e=this.model,f=e.find(a.id),g=e.find(d.id),h=e.isDisable(g,f);e.find(d.id)&&d.id!==a.id&&!h&&e.move(a.id,f,d.id),c.removeEventListener(document,"mousemove",this.move),c.removeEventListener(document,"mouseup",this.up)},enableHelper:function(a,b){this.helperElement||(this.helperElement=document.createElement("span"),this.helperElement.style.position="absolute",this.helperElement.style.display="none",this.root.parentNode.appendChild(this.helperElement)),this.helperElement.innerHTML=b},setHelperLocation:function(a){this.helperElement.style.left=a.x+this.helperPos.x+"px",this.helperElement.style.top=a.y+this.helperPos.y+"px",this.helperElement.style.display="block"},disableHelper:function(){this.helperElement&&(this.helperElement.style.display="none")},_getHtml:function(a){var b,c,d,e,f,g,h,i,j=this.model,k=[];return ne.util.forEach(a,function(a){c=j.find(a),e=c.depth,f=this[c.state+"Set"][0],g=this[c.state+"Set"][1],h=this.depthLabels[e-1]||"",i={State:f,StateLabel:g,NodeID:c.id,Depth:e,Title:c.value,ValueClass:this.valueClass,SubTree:this.subtreeClass,Display:"open"===c.state?"":"none",DepthLabel:h},ne.util.isNotEmpty(c.childKeys)?(d=this.template.EDGE_NODE,i.Children=this._getHtml(c.childKeys)):d=this.template.LEAP_NODE,a=d.replace(/\{\{([^\}]+)\}\}/g,function(a,b){return i[b]||""}),k.push(a)},this),b=k.join("")},notify:function(a,b){this.action(a,b)},action:function(a,b){this._actionMap=this._actionMap||{refresh:this._refresh,rename:this._rename,toggle:this._toggleNode,select:this._select,unselect:this._unSelect,convert:this._convert,restore:this._restore},this._actionMap[a||"refresh"].call(this,b)},_changeNodeState:function(a){var b=document.getElementById(a.id);if(b){var c=b.parentNode,d=c.className;d=ne.util.isEmpty(a.childKeys)?"leap_node "+this[a.state+"Set"][0]:"edge_node "+this[a.state+"Set"][0],c.className=d}},_convert:function(a){var b=a.id,c=this.model.find(b),d=c.value,e=a.parentNode;this.current&&(this.current.style.display=""),a.style.display="none",this.inputElement.value=d,this.current=a,e.insertBefore(this.inputElement,a),this.inputElement.focus()},_restore:function(a){var b=a.parentNode;this.current&&(this.current.style.display=""),this.inputElement.value="",b.removeChild(this.inputElement)},_draw:function(a,b){var c=b||this.root;c.innerHTML=a},setDepthLabels:function(a){this.depthLabels=a},_refresh:function(){var a=this.model.treeHash.root.childKeys;this._draw(this._getHtml(a))},_rename:function(a){var b=document.getElementById(a.id);b.innerHTML=a.value},_toggleNode:function(a){var b=document.getElementById(a.id),c=b.parentNode,d=c.getElementsByTagName("ul")[0],e=c.getElementsByTagName("button")[0],f=this[a.state+"Set"][0],g=this[a.state+"Set"][1],h="open"===a.state;c.className=c.className.replace(this.openSet[0],"").replace(this.closeSet[0],"")+f,d.style.display=h?"":"none",e.innerHTML=g},_select:function(a){var b=document.getElementById(a.id);ne.util.isExisty(b)&&(b.className=b.className.replace(" "+this.onselectClass,"")+" "+this.onselectClass)},_unSelect:function(a){var b=document.getElementById(a.id);ne.util.isExisty(b)&&c.hasClass(b,this.onselectClass)&&(b.className=b.className.replace(" "+this.onselectClass,""))}}),ne.component.Tree.TreeModel=ne.util.defineClass({init:function(a,b){this.count=0,this.tree=b,this.nodeDefaultState=a.defaultState||"close",this.buffer=null,this.depth=0,this.date=(new Date).getTime(),this.treeHash={},this.treeHash.root=this.makeNode(0,"root","root"),this.connect(b)},setData:function(a){this.treeHash.root.childKeys=this._makeTreeHash(a)},_makeTreeHash:function(a,b){var c,d=[];return this.depth=this.depth+1,ne.util.forEach(a,function(a){c=this._getId(),this.treeHash[c]=this.makeNode(this.depth,c,a.value,b),a.children&&ne.util.isNotEmpty(a.children)&&(this.treeHash[c].childKeys=this._makeTreeHash(a.children,c)),d.push(c)},this),this.depth=this.depth-1,d.sort(ne.util.bind(this.sort,this)),d},makeNode:function(a,b,c,d){return{depth:a,value:c,parentId:0===a?null:d||"root",state:this.nodeDefaultState,id:b}},_getId:function(){return this.count=this.count+1,"node_"+this.date+"_"+this.count},find:function(a){return this.treeHash[a]},remove:function(a){var b=this.invoke("remove",{id:a});b&&(this.removeKey(a),this.treeHash[a]=null,this.notify())},removeKey:function(a){var b=this.find(a);if(b){var c=this.find(b.parentId);c.childKeys=ne.util.filter(c.childKeys,function(b){return b!==a})}},move:function(a,b,c){this.removeKey(a),this.treeHash[a]=null,this.insert(b,c)},insert:function(a,b){var c=this.find(b||"root");c.childKeys||(c.childKeys=[]),c.childKeys.push(a.id),a.depth=c.depth+1,a.parentId=b,c.childKeys.sort(ne.util.bind(this.sort,this)),this.treeHash[a.id]=a,this.notify()},notify:function(a,b){this.tree&&this.tree.notify(a,b)},connect:function(a){a&&(this.tree=a)},rename:function(a,b){var c=this.invoke("rename",{id:a,value:b});if(c){var d=this.find(a);d.value=b,this.notify("rename",d)}},changeState:function(a){var b=this.find(a);b.state="open"===b.state?"close":"open",this.notify("toggle",b)},setBuffer:function(a){this.clearBuffer();var b=this.find(a);this.notify("select",b),this.fire("select",{id:a,value:b.value}),this.buffer=b},clearBuffer:function(){this.buffer&&(this.notify("unselect",this.buffer),this.buffer=null)},isDisable:function(a,b){return a.depth===b.depth?!1:a.parentId?a.id===b.parentId?!0:a.parentId===b.id?!0:this.isDisable(this.find(a.parentId),b):void 0},sort:function(a,b){var c=this.find(a),d=this.find(b);return c&&d?c.value<d.value?-1:c.value>d.value?1:0:0}}),ne.util.CustomEvents.mixin(ne.component.Tree.TreeModel)}();
//# sourceMappingURL=tree.min.map