 <!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">

    <title>Tree Component</title>
    <link rel="stylesheet" href="css/samplepage.css" />
    <link rel="stylesheet" href="css/tree.css" />
    <link rel="stylesheet" href="//cdn.rawgit.com/nhnent/tui.component.contextmenu/1.1.2/dist/contextmenu.css" />
</head>
<body>
    <div class="code-html">
        <!-- Tree area -->
        <div class="treeWrap">
            <ul id="treeRoot" class="tree"></ul>
        </div>
        <!-- Ajax request info area -->
        <textarea id="infoArea"></textarea>
    </div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="//cdn.rawgit.com/nhnent/tui.code-snippet/1.2.1/code-snippet.js"></script>
    <script src="//cdn.rawgit.com/nhnent/tui.dom/2.1.0/dist/domutil.js"></script>
    <script src="//cdn.rawgit.com/nhnent/tui.component.floatinglayer/1.0.1/dist/floatingLayer.js"></script>
    <script src="//cdn.rawgit.com/nhnent/tui.component.contextmenu/1.1.2/dist/tui-component-contextmenu.js"></script>
    <script src="../dist/tui-component-tree.js"></script>
    <script class="code-js">
        var infoArea = document.getElementById('infoArea');

        // Create Tree component
        var tree = new tui.component.Tree([], {
            nodeDefaultState: 'opened',
            rootElement: document.getElementById('treeRoot'),
            template: { // User custom template
                internalNode:
                    '<button type="button" class="{{toggleBtnClass}}">{{stateLabel}}</button>' +
                    '<span class="{{textClass}}">{{text}}</span>' +
                    '<ul class="{{subtreeClass}}">{{children}}</ul>',
                leafNode:
                    '<span class="{{textClass}}">{{text}}</span>'
            }
        });

        // Add features
        tree.enableFeature('Selectable')
            .enableFeature('Editable', {
            editableClassName: tree.classNames.textClass,
            dataKey: 'text'
        }).enableFeature('Draggable', {
            isSortable: true,
            lineClassName: 'tui-tree-marker',
            lineBoundary: {
                top: 10,
                bottom: 10
            }
        }).enableFeature('ContextMenu', {
            menuData: [
                {title: 'create', command: 'create'},
                {title: 'update', command: 'update'},
                {title: 'remove', command: 'remove'}
            ]
        }).enableFeature('Ajax', {
            command: {
                read: {
                    url: 'data/tree.js',
                    dataType: 'jsonp',
                    jsonpCallback: 'dataCallback',
                    data: function(params) {
                        return {
                            productId: tree.getNodeData(params.nodeId).pid
                        };
                    }
                },
                create: {
                    url: 'data/response.js',
                    dataType: 'jsonp',
                    jsonpCallback: 'dataCallback',
                    data: function(params) {
                        return {
                            targetId: tree.getNodeData(params.parentId).pid,
                            productName: params.data.text
                        };
                    }
                },
                update: {
                    url: 'data/response.js',
                    dataType: 'jsonp',
                    jsonpCallback: 'dataCallback',
                    data: function(params) {
                        return {
                            productId: tree.getNodeData(params.nodeId).pid,
                            productName: params.data.text
                        };
                    }
                },
                remove: {
                    url: 'data/response.js',
                    dataType: 'jsonp',
                    jsonpCallback: 'dataCallback',
                    data: function(params) {
                        return {
                            productId: tree.getNodeData(params.nodeId).pid
                        };
                    }
                },
                move: {
                    url: 'data/response.js',
                    dataType: 'jsonp',
                    jsonpCallback: 'dataCallback',
                    data: function(params) {
                        return {
                            productId: tree.getNodeData(params.nodeId).pid,
                            targetId: tree.getNodeData(params.newParentId).pid,
                            moveIdx: params.index
                        };
                    }
                }
            },
            parseData: function(command, response) {
                if (command === 'read') {
                    return response.code === '200' ? response.tree : false;
                } else {
                    return response.code === '200';
                }
            }
        });

        // Bind custom event
        tree.on('selectContextMenu', function(e) {
            var cmd = e.cmd;
            var nodeId = e.nodeId;

            switch (cmd) {
                case 'create':
                    tree.createChildNode(nodeId);
                    break;
                case 'update':
                    tree.editNode(nodeId);
                    break;
                case 'remove':
                    tree.remove(nodeId);
                    break;
            }
        });

        tree.on('beforeCreateChildNode', function() {
            return confirm('create?');
        });

        tree.on('beforeEditNode', function() {
            return confirm('edit?');
        });

        tree.on('select', function(nodeId) {
            console.log(nodeId);
        });

        tree.on('successAjaxResponse', function(command, data) {
            var message;

            if (command === 'create') {
                console.log('created node id : ' + data);
            }

            message = 'command command : ' + command  + '\n';
            message += 'jQuery request options : \n';
            message += JSON.stringify(tree.enabledFeatures.Ajax.command[command], null, 8);

            infoArea.value = message;
        });
    </script>
    </body>
</html>
