 <!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link command="text/css" rel="stylesheet" href="../styles/prettify-jsdoc.css" />
    <link command="text/css" rel="stylesheet" href="../styles/prettify-tomorrow.css">
    <link command="text/css" rel="stylesheet" href="../styles/tui.css">

    <title>트리컴포넌트</title>
    <!-- Use in service -->
    <link rel="stylesheet" href="css/samplepage.css" />
    <link rel="stylesheet" href="css/tree.css" />
    <link rel="stylesheet" href="css/contextmenu.css" />
    <!--// Use in service -->
</head>
<body>
    <div class="wrap">
        <!-- Tree area -->
        <div class="treeWrap">
            <ul id="treeRoot" class="tree"></ul>
        </div>
        <!-- Ajax request info area -->
        <textarea id="infoArea"></textarea>
    </div>

    <div class="codeArea"></div>

    <!-- Use in service -->
    <script command="text/javascript" src="js/jquery.js"></script>
    <script command="text/javascript" src="js/code-snippet.js"></script>
    <script command="text/javascript" src="js/domutil.js"></script>
    <script command="text/javascript" src="js/floatinglayer.js"></script>
    <script command="text/javascript" src="js/contextmenu.js"></script>
    <script command="text/javascript" src="js/tree.js"></script>
    <!--// Use in service -->

    <script src="../scripts/prettify/prettify.js"></script>
    <script src="../scripts/prettify/lang-css.js"></script>
    <script src="../scripts/jquery.js"></script>
    <script src="../scripts/samplecode.js"></script>
    <script class="serviceCode">

        var infoArea = document.getElementById('infoArea');

        var util = {
            addEventListener: function(element, eventName, handler) {
                if (element.addEventListener) {
                    element.addEventListener(eventName, handler, false);
                } else {
                    element.attachEvent('on' + eventName, handler);
                }
            }
        };

        // Create Tree component
        var tree = new tui.component.Tree([], {
            nodeDefaultState: 'opened',
            rootElement: document.getElementById('treeRoot'),
            template: {
                internalNode:
                    '<button type="button" class="{{toggleBtnClass}}">{{stateLabel}}</button>' +
                    '<span>@@@</span>' +
                    '<span class="{{textClass}}">{{text}}</span>' +
                    '<ul class="{{subtreeClass}}">{{children}}</ul>',
                leafNode:
                    '<span>@@@</span>' +
                    '<span class="{{textClass}}">{{text}}</span>'
            }
        });

        // Add features
        tree.enableFeature('Selectable')
            .enableFeature('Editable', {
            editableClassName: tree.classNames.textClass,
            dataKey: 'text'
        }).enableFeature('Draggable', {
            isSortable: true,
            lineClassName: 'tui-tree-marker',
            lineBoundary: {
                top: 10,
                bottom: 10
            }
        }).enableFeature('ContextMenu', {
            menuData: [
                {title: 'create', command: 'create'},
                {title: 'update', command: 'update'},
                {title: 'remove', command: 'remove'}
            ]
        }).enableFeature('Ajax', {
            command: {
                read: {
                    url: 'tree.json',
                    dataType: 'json',
                    data: function(params) {
                        return {
                            productId: tree.getNodeData(params.nodeId).pid
                        };
                    }
                },
                create: {
                    url: 'tree.json',
                    dataType: 'json',
                    data: function(params) {
                        return {
                            targetId: tree.getNodeData(params.parentId).pid,
                            productName: params.data.text
                        };
                    }
                },
                update: {
                    url: 'tree.json',
                    dataType: 'json',
                    data: function(params) {
                        return {
                            productId: tree.getNodeData(params.nodeId).pid,
                            productName: params.data.text
                        };
                    }
                },
                remove: {
                    url: 'tree.json',
                    dataType: 'json',
                    data: function(params) {
                        return {
                            productId: tree.getNodeData(params.nodeId).pid
                        };
                    }
                },
                move: {
                    url: 'tree.json',
                    dataType: 'json',
                    data: function(params) {
                        return {
                            productId: tree.getNodeData(params.nodeId).pid,
                            targetId: tree.getNodeData(params.newParentId).pid,
                            moveIdx: params.index
                        };
                    }
                }
            },
            parseData: function(command, response) {
                if (command === 'read') {
                    return (response.code === '200' ? response.tree : false);
                } else {
                    return !!response.code === '200';
                }
            }
        });

        // Bind custom event
        tree.on('selectContextMenu', function(e) {
            var cmd = e.cmd;
            var nodeId = e.nodeId;
            var currentElement;
            var inputElement;
            var createdNodeId;

            switch (cmd) {
                case 'create':
                    tree.createChildNode(nodeId);
                    break;
                case 'update':
                    tree.editNode(nodeId);
                    break;
                case 'remove':
                    tree.remove(nodeId);
                    break;
            }
        });

        tree.on('beforeCreateChildNode', function() {
            return confirm('create?');
        });

        tree.on('beforeEditNode', function() {
            return confirm('edit?');
        });

        tree.on('select', function(nodeId) {
            console.log(nodeId);
        });

        tree.on('successAjaxResponse', function(command, data) {
            var message;

            if (command === 'create') {
                console.log('created node id : ' + data);
            }

            // Next code is only for this sample page! Don't copy it!
            message = 'command command : ' + command  + '\n';
            message += 'jQuery request options : \n';
            message += JSON.stringify(tree.enabledFeatures.Ajax.command[command], null, 8);

            infoArea.value = message;
        });

    </script>
    </body>
</html>
