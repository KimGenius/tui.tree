!function(){!function(a){"use strict";a||(a=window.ne={}),a.util||(a.util=window.ne.util={});var b=function(b,c){var d;return c||(c=b,b=null),d=c.init||function(){},b&&a.util.inherit(d,b),c.hasOwnProperty("static")&&(a.util.extend(d,c["static"]),delete c["static"]),a.util.extend(d.prototype,c),d};a.util.defineClass=b}(window.ne),function(a){"use strict";function b(a,b,c){for(var d=0,e=a.length;e>d&&b.call(c||null,a[d],d,a)!==!1;d++);}function c(a,b,c){var d;for(d in a)if(a.hasOwnProperty(d)&&b.call(c||null,a[d],d,a)===!1)break}function d(b,c,d){var e,f;if(a.util.isArray(b))for(e=0,f=b.length;f>e;e++)c.call(d||null,b[e],e,b);else a.util.forEachOwnProperties(b,c,d)}function e(b,c,d){var e=[];return a.util.forEach(b,function(){e.push(c.apply(d||null,arguments))}),e}function f(b,c,d){var e,f,g,h=0;for(a.util.isArray(b)||(e=a.util.keys(b)),f=e?e.length:b.length,g=b[e?e[h++]:h++];f>h;h++)g=c.call(d||null,g,b[e?e[h]:h]);return g}function g(a){var c;try{c=Array.prototype.slice.call(a)}catch(d){c=[],b(a,function(a){c.push(a)})}return c}a||(a=window.ne={}),a.util||(a.util=window.ne.util={});var h=function(b,c,d){var e,f,g=a.util.isArray(b)?[]:{};if(!a.util.isObject(b)||!a.util.isFunction(c))throw new Error("wrong parameter");return a.util.forEach(b,function(){c.apply(d||null,arguments)&&(e=arguments[0],f=arguments[1],a.util.isArray(b)?g.push(e):g[f]=e)},d),g};a.util.forEachOwnProperties=c,a.util.forEachArray=b,a.util.forEach=d,a.util.toArray=g,a.util.map=e,a.util.reduce=f,a.util.filter=h}(window.ne),function(a){"use strict";function b(b,e){if(arguments.length<2)return!d(b)&&!c(b);if(!i(b))return!1;if(e=l(e)?e.split("."):e,!h(e))return!1;e.unshift(b);var f=a.util.reduce(e,function(a,b){return a?a[b]:void 0});return!d(f)&&!c(f)}function c(a){return void 0===a}function d(a){return null===a}function e(a){return b(a)&&a!==!1}function f(a){return!e(a)}function g(a){var c=b(a)&&("[object Arguments]"===r.call(a)||"callee"in a);return c}function h(a){return"[object Array]"===r.call(a)}function i(a){return a===Object(a)}function j(a){return"[object Function]"===r.call(a)}function k(a){return"[object Number]"===r.call(a)}function l(a){return"[object String]"===r.call(a)}function m(a){return"[object Boolean]"===r.call(a)}function n(a){return"object"==typeof HTMLElement?a&&(a instanceof HTMLElement||!!a.nodeType):!(!a||!a.nodeType)}function o(a){return"object"==typeof HTMLElement?a&&a instanceof HTMLElement:!(!a||!a.nodeType||1!==a.nodeType)}function p(c){var d=!1;return b(c)?h(c)||g(c)?0===c.length:i(c)&&!j(c)?(a.util.forEachOwnProperties(c,function(){return d=!0,!1}),!d):!0:!0}function q(a){return!p(a)}a||(a=window.ne={}),a.util||(a.util=window.ne.util={});var r=Object.prototype.toString;a.util.isExisty=b,a.util.isUndefined=c,a.util.isNull=d,a.util.isTruthy=e,a.util.isFalsy=f,a.util.isArguments=g,a.util.isArray=Array.isArray||h,a.util.isObject=i,a.util.isFunction=j,a.util.isNumber=k,a.util.isString=l,a.util.isBoolean=m,a.util.isHTMLNode=n,a.util.isHTMLTag=o,a.util.isEmpty=p,a.util.isNotEmpty=q}(window.ne),function(a){"use strict";function b(a){var b,c,d,e,f=Object.prototype.hasOwnProperty;for(d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)f.call(b,c)&&(a[c]=b[c])}return a}function c(a){return a.__fe_id=a.__fe_id||++e,a.__fe_id}function d(){e=0}a||(a=window.ne={}),a.util||(a.util=window.ne.util={});var e=0,f=function(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b);return c};a.util.extend=b,a.util.stamp=c,a.util._resetLastId=d,a.util.keys=Object.keys||f}(window.ne),function(a){"use strict";function b(a,b){var c=Array.prototype.slice;if(a.bind)return a.bind.apply(a,c.call(arguments,1));var d=c.call(arguments,2);return function(){return a.apply(b,d.length?d.concat(c.call(arguments)):arguments)}}a||(a=window.ne={}),a.util||(a.util=window.ne.util={}),a.util.bind=b}(window.ne),function(a){"use strict";function b(){this._events={}}a||(a=window.ne={}),a.util||(a.util=window.ne.util={});var c={on:function(a,b,c){this._toggle(!0,a,b,c)},off:function(b,c,d){return a.util.isExisty(b)?void this._toggle(!1,b,c,d):void(this._events=null)},_toggle:function(b,c,d,e){var f=b?"_on":"_off",g=this[f];a.util.isObject(c)?a.util.forEachOwnProperties(c,function(a,b){g.call(this,b,a,d)},this):(c=c.split(" "),a.util.forEach(c,function(a){g.call(this,a,d,e)},this))},_on:function(b,c,d){var e=this._events=this._events||{},f=d&&d!==this&&a.util.stamp(d);if(f){var g=b+"_idx",h=b+"_len",i=e[g]=e[g]||{},j=a.util.stamp(c)+"_"+f;i[j]||(i[j]={fn:c,ctx:d},e[h]=(e[h]||0)+1)}else e[b]=e[b]||[],e[b].push({fn:c})},_off:function(b,c,d){var e=this._events,f=b+"_idx",g=b+"_len";if(e){var h,i,j=d&&d!==this&&a.util.stamp(d);j?(i=a.util.stamp(c)+"_"+j,h=e[f],h&&h[i]&&(h[i]=null,e[g]-=1)):(h=e[b],h&&a.util.forEach(h,function(b,d){return a.util.isExisty(b)&&b.fn===c?(h.splice(d,1),!0):void 0}))}},invoke:function(b,c){if(!this.hasListener(b))return this;var d=a.util.extend({},c,{type:b,target:this}),e=this._events;if(e){var f,g=e[b+"_idx"],h=!0;return e[b]&&(f=e[b].slice(),a.util.forEach(f,function(a){h=h&&!!a.fn.call(this,d)},this)),a.util.forEachOwnProperties(g,function(a){h=h&&!!a.fn.call(a.ctx,d)}),a.util.isBoolean(h)?h:!1}},fire:function(a,b){return this.invoke(a,b),this},hasListener:function(b){var c=this._events,d=a.util.isExisty;return d(c)&&(d(c[b])||c[b+"_len"])},getListenerLength:function(b){var c,d,e=this._events,f=b+"_len",g=0;return a.util.isExisty(e)?(c=e[b],d=e[f],g+=a.util.isExisty(c)&&a.util.isArray(c)?c.length:0,g+=a.util.isExisty(d)?d:0):0},once:function(b,c,d){function e(){c.apply(d,arguments),f.off(b,e,d)}var f=this;return a.util.isObject(b)?void a.util.forEachOwnProperties(b,function(a){this.once(a,b[a],c)},this):void this.on(b,e,d)}};b.prototype=c,b.prototype.constructor=b,b.mixin=function(b){a.util.extend(b.prototype,c)},a.util.CustomEvents=b}(window.ne),ne=ne||{},ne.component=ne.component||{},ne.component.Tree=ne.util.defineClass({init:function(a){this.model=new ne.component.Tree.TreeModel(a.config),this.model.setData(a.data),this.inputElement=document.createElement("input"),this.inputElement.className=a.config.inputElementClass||"",this.inputElement.setAttribute("type","text"),this.view=new ne.component.Tree.TreeView(a.config,this.model.getFirstChildren()),this.event=new ne.component.Tree.TreeEvent,this.isInputEnabled=!1,this.editableObject=null,this.model.listen(this.view),this._setEvent()},_setEvent:function(){this.event.add(this.view.root,"click",ne.util.bind(this._onClickEvent,this)),this.event.add(this.view.root,"doubleclick",ne.util.bind(this._onDoubleClick,this))},_onClickEvent:function(a){a.isButton?this.model.changeState(a.paths):a.paths&&(this.model.setBuffer(a.paths),this.fire("click",a))},_onDoubleClick:function(a){var b=a.target,c=this._getValueElement(a.path),d=this.inputElement;this.editableObject={element:b,path:a.path,valueElement:c},b.insertBefore(d,c),c.style.display="none",d.style.display="",d.value=this.model.findNode(a.path).title,d.focus(),this.isInputEnabled||this._openInputEvent()},_getValueElement:function(a){var b=this.model.findNode(a),c=document.getElementById(b.id);return c},_updateName:function(){var a=this.inputElement.value;a&&this.rename(this.editableObject.path,a),this._stopEditable()},_onKeyDownInputElement:function(a){13===a.keyCode&&this._updateName()},_onBlurInputElement:function(){this._updateName()},_onClickInputElement:function(a){ne.component.Tree.treeUtils.stopEvent(a)},_openInputEvent:function(){var a=ne.component.Tree.treeUtils;this.isInputEnabled=!0,a.addEventListener(this.inputElement,"keyup",ne.util.bind(this._onKeyDownInputElement,this)),a.addEventListener(this.inputElement,"blur",ne.util.bind(this._onBlurInputElement,this)),a.addEventListener(this.inputElement,"click",ne.util.bind(this._onClickInputElement,this))},_stopEditable:function(){this.inputElement.value="",this.inputElement.style.display="none",this.editableObject.valueElement.style.display=""},insert:function(a,b){var c=this.invoke("insert",{path:a,value:b});c&&(b?(a=a.toString(),this.model.insertNode(a,b)):(b=a,this.model.insertNode(null,b)))},remove:function(a){if(a){var b=this.invoke("remove",{path:a});b&&this.model.removeNode(a)}},rename:function(a,b){var c=this.invoke("rename",{path:a,value:b});c&&this.model.renameNode(a,b)},sort:function(a,b){this.model.sort(a,b)},getModelData:function(){return this.model.getData()},setDepthLabels:function(a){if(!a||!ne.util.isObject(a))throw new TypeError;this.view.setDepthLabels(a),this.view.action("refresh",this.model.nodes)}}),ne.util.CustomEvents.mixin(ne.component.Tree),ne.component.Tree.TreeNode=ne.util.defineClass({init:function(a){this.id=a.id,this.title=a.title,this.type=a.type||"default",this.state=a.state||"close",this.childNodes=null,this.parent=null,this.siblings=null},set:function(a,b){this[a]=b},get:function(a){return this[a]}}),ne.component.Tree.TreeEvent=ne.util.defineClass({init:function(){this.doubleClickTimer=null},add:function(a,b,c){"doubleclick"===b?this._addDoubleClickEvent(a,b,c):this._addEventListener(a,b,c)},_addEventListener:function(a,b,c){ne.component.Tree.treeUtils.addEventListener(a,b,ne.util.bind(this._onClick,this,c,b))},_onClick:function(a,b,c){c=c||window.event;var d=c.target||c.srcElement,e=d.tagName.toLowerCase(),f=null;if(this._checkRightButton(c.which||c.button))return void ne.component.Tree.treeUtils.stopEvent(c);if("button"===e){var g=d.parentNode,h=g;f=h.getAttribute("path")}else f=d.getAttribute("path"),f||(f=d.parentNode.getAttribute("path"));ne.util.extend(c,{eventType:b,isButton:"button"===e,target:d,paths:f}),a(c)},_addDoubleClickEvent:function(a,b,c){ne.component.Tree.treeUtils.addEventListener(a,"click",ne.util.bind(this._onDoubleClick,this,c,b))},_onDoubleClick:function(a,b,c){c=c||window.event;var d=c.target||c.srcElement,e="BUTTON"===c.target.tagName.toUpperCase(),f=d.getAttribute("path")||d.parentNode.getAttribute("path"),d=d.parentNode.getAttribute("path")?d.parentNode:d,g=d.innerText;return e?void(this.doubleClickTimer=null):this._checkRightButton(c.which||c.button)?(this.doubleClickTimer=null,void ne.component.Tree.treeUtils.stopEvent(c)):f||isNaN(f)?(this.targetPath&&this.targetPath!==f&&(this.doubleClickTimer=null),this.doubleClickTimer?(a({eventType:b,target:d,path:f,text:g}),this.doubleClickTimer=null):this.doubleClickTimer=setTimeout(ne.util.bind(function(){this.doubleClickTimer=null},this),500),void(this.targetPath=f)):void(this.doubleClickTimer=null)},_checkRightButton:function(a){var b=3==a||2==a;return b}}),ne.component.Tree.TreeModel=ne.util.defineClass({init:function(a){this.nodes=new ne.component.Tree.TreeNode({id:a.viewId,title:"",state:"open"}),this.count=0,this.views=[],this.nodeDefaultState=a.defaultState||"close",this.buffer=null,this.date=(new Date).getTime()},setData:function(a){this.data=a,this._makeTree(this.data,this.nodes)},listen:function(a){this.views.push(a)},_notify:function(a,b){ne.util.forEach(this.views,function(c){c.action(a,b)})},getFirstChildren:function(){return this.nodes.childNodes},insertNode:function(a,b){b||(b={title:"no Title"}),ne.util.isArray(b)||(b=[b]);var c=null;a&&(c=this.findNode(a)),c=c||this.nodes,this._makeTree(b,c),this._notify("refresh",c)},removeNode:function(a){if(!a)throw new Error("must insert target ID");var b=this.findNode(a),c=b.parent;c.childNodes=ne.util.filter(c.childNodes,function(a){return a!==b}),b.parent=null,this._notify("remove",c)},findNode:function(a){var b=null,c=a.split(",");return ne.util.forEach(c,ne.util.bind(function(a){b=b?b.childNodes&&b.childNodes[a]:this.nodes.childNodes&&this.nodes.childNodes[a]},this)),b},_makeTree:function(a,b){b.childNodes||(b.childNodes=[]),ne.util.forEach(a,ne.util.bind(function(a){var c=new ne.component.Tree.TreeNode({id:this._getIdentification(),title:a.title,state:this.nodeDefaultState});b?(c.parent=b,b.childNodes.push(c)):c.parent=this.nodes,a.children&&this._makeTree(a.children,c)},this))},_getIdentification:function(){var a="tree_"+this.date;return a+"_"+this.count++},renameNode:function(a,b){var c=this.findNode(a);c.set("title",b),this._notify("rename",c)},changeState:function(a){var b=this.findNode(a);"open"===b.get("state")?b.set("state","close"):b.set("state","open"),this._notify("toggle",b)},setBuffer:function(a){this.clearBuffer();var b=this.findNode(a);this.buffer=b,this._notify("select",b)},clearBuffer:function(){if(this.buffer){var a=this.buffer;this.buffer=null,this._notify("unselect",a)}},getData:function(){return this.nodes},sort:function(a,b){var c=this.findNode(a)||this.nodes;c.childNodes.sort(b),this._notify("refresh",c)},sortChild:function(a){a.sort(function(a,b){return a.title<b.title?-1:a.title>b.title?1:0})}}),ne.component.Tree.TreeView=ne.util.defineClass({init:function(a,b){this.template=a.template||{hasChild:'<li class="hasChild {{State}}" path="{{Path}}">                            <button type="button">{{StateLabel}}</button>                            <span id="{{NodeID}}" class="depth{{Depth}}">{{Title}}</span><em>{{DepthLabel}}</em>                            <ul class="subTree">                                {{ChildNodes}}                            </ul>                        </li>',leapNode:'<li class="leapNode" path="{{Path}}">                        <span id="{{NodeID}}" class="depth{{Depth}}">{{Title}}</span><em>{{DepthLabel}}</em>                    </li>'},this.root=null,this.path=[],this.openSet=a.openSet||["open","-"],this.closeSet=a.closeSet||["close","+"],this.onSelectClassName=a.onSelectClassName||"select",this.depthLabels=a.depthLabels||[],a.viewId?this.root=document.getElementById(a.viewId):(this.root=document.createElement("ul"),document.body.appendChild(this.root)),this._makeTree(b)},_makeTree:function(a){this._draw(this._makeHTML(a))},_makeHTML:function(a,b){var c,d=[],b=b||null,e="",f=a.length;return ne.util.forEach(a,function(a,c){this.path.push(c),e=null!==b?[b,this.path.join()].join():this.path.join();var g=e.split(",").length,h=this.depthLabels[g-1]||"",i=this[a.state+"Set"][0],j=this[a.state+"Set"][1],k=null,l={State:i,StateLabel:j,NodeID:a.id,Path:e,Depth:g,Title:a.title,DepthLabel:h};ne.util.isNotEmpty(a.childNodes)?(k=this.template.hasChild,l.ChildNodes=this._makeHTML(a.childNodes,b)):k=this.template.leapNode,k=k.replace(/\{\{([^\}]+)\}\}/g,function(a,b){return l[b]||""}),c===f-1&&1!==g&&(k=k.replace('class="','class="last '));var m="close"===a.get("state");m&&(k=k.replace("<ul ",'<ul style="display:none"')),d.push(k),this.path.pop()},this),c=d.join("")},_changeTargetClass:function(a){var b=document.getElementById(a.id);if(b){var c=b.parentNode,d=c.className;d=a.childNodes&&!a.childNodes.length?"leapNode "+this[a.state+"Set"][0]:"hasChild "+this[a.state+"Set"][0],c.className=d}},action:function(a,b){this._actionMap=this._actionMap||{remove:this._remove,refresh:this._refresh,rename:this._rename,toggle:this._toggle,select:this._select,unselect:this._unSelect},this._actionMap[a].call(this,b)},_draw:function(a,b){var c=b||this.root;c.innerHTML=a},setDepthLabels:function(a){this.depthLabels=a},_remove:function(a){var b=document.getElementById(a.id);b&&(b=b.parentNode.getElementsByTagName("ul")[0]),this._changeTargetClass(a);var c=a.childNodes;this._draw(this._makeHTML(c),b)},_refresh:function(a){this._changeTargetClass(a);var b=a.childNodes,c=a.get("id");c&&c!==this.root.getAttribute("id")?this._refreshPartOfTree(a):this._draw(this._makeHTML(b))},_refreshPartOfTree:function(a){var b,c,d=a.get("id"),e=document.getElementById(d),f=a.parent,g=f.get("id"),h=e.getElementsByTagName("ul")&&e.getElementsByTagName("ul")[0],i=!!h;i?b=a.childNodes:(e=document.getElementById(g),h=e.parentNode.getElementsByTagName("ul")[0],b=f.childNodes),c=e.parentNode.getAttribute("path"),c?this._draw(this._makeHTML(b,c),h):this._draw(this._makeHTML(b))},_rename:function(a){var b=a.get("id"),c=document.getElementById(b);c.innerHTML=a.title},_toggle:function(a){var b=document.getElementById(a.get("id")),c=b.parentNode,d=c.getElementsByTagName("ul")[0],e=c.getElementsByTagName("button")[0],f=this[a.state+"Set"][0],g=this[a.state+"Set"][1],h="open"===a.get("state");c.className=c.className.replace(this.openSet[0],"").replace(this.closeSet[0],"")+f,d.style.display=h?"":"none",e.innerHTML=g},_select:function(a){var b=document.getElementById(a.id);ne.util.isExisty(b)&&(b.className=b.className.replace(" "+this.onSelectClassName,"")+" "+this.onSelectClassName)},_unSelect:function(a){var b=document.getElementById(a.id);ne.util.isExisty(b,"className")&&-1!==b.className.indexOf(this.onSelectClassName)&&(b.className=b.className.replace(" "+this.onSelectClassName,""))}}),ne.component.Tree.treeUtils={addEventListener:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeEventListener:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},stopEvent:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}}}();